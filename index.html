<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ ¡å›­é—²ç½®é€Ÿé…</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1920px;
            margin: 0 auto;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .search-section {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: #fff;
            padding: 10px 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-section .search-container {
            max-width: 1920px;
            width: 100%;
            margin: 0 auto;
            display: flex;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            height: 40px;
            padding: 0 15px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .search-input:focus {
            border-color: #4a90e2;
        }

        .search-btn {
            width: 80px;
            height: 40px;
            background: #4a90e2;
            color: #fff;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .search-btn:hover {
            background: #357abd;
        }

        .search-btn:active {
            background: #2a6496;
        }

        .search-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .goods-section {
            flex: 1;
            margin-top: 60px;
            margin-bottom: 70px;
            padding: 15px;
        }

        .goods-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            max-width: 1920px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .goods-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .goods-card {
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            position: relative;
        }

        .goods-tag {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #ff4d4f;
            color: #fff;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 10;
        }

        .goods-images {
            display: flex;
            height: 120px;
            cursor: pointer;
        }

        .goods-image {
            flex: 1;
            object-fit: cover;
            border-right: 1px solid #f0f0f0;
        }

        .goods-image:last-child {
            border-right: none;
        }

        .goods-name {
            padding: 10px 12px;
            color: #333;
            font-size: 15px;
            font-weight: bold;
            background: #fff;
        }

        .goods-desc {
            padding: 0 12px 12px;
            color: #666;
            font-size: 13px;
            line-height: 1.5;
            min-height: 40px;
            cursor: pointer;
        }

        .goods-desc:hover {
            color: #4a90e2;
            text-decoration: underline;
        }

        .goods-detail-content {
            max-width: 600px;
        }

        .goods-detail-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .goods-detail-section:last-child {
            border-bottom: none;
        }

        .goods-detail-name {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .goods-detail-category {
            font-size: 14px;
            color: #999;
            background: #f5f5f5;
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
        }

        .goods-detail-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .goods-detail-images {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .detail-image {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .goods-detail-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .goods-detail-price {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .detail-sale-price {
            font-size: 24px;
            font-weight: bold;
            color: #ff6b35;
        }

        .detail-original-price {
            font-size: 14px;
            color: #999;
            text-decoration: line-through;
        }

        .goods-detail-contact {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-contact-text {
            font-size: 16px;
            color: #333;
            flex: 1;
        }

        .goods-price {
            padding: 0 12px 8px;
            display: flex;
            align-items: baseline;
            gap: 10px;
        }

        .sale-price {
            color: #333;
            font-size: 18px;
            font-weight: bold;
        }

        .original-price {
            color: #999;
            font-size: 12px;
            font-style: italic;
        }

        .goods-contact {
            padding: 8px 12px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-top: 1px solid #f5f5f5;
        }

        .contact-text {
            color: #666;
            font-size: 13px;
        }

        .copy-btn {
            padding: 4px 12px;
            background: #f0f0f0;
            color: #666;
            border: none;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: #e0e0e0;
        }

        .copy-btn:active {
            background: #d0d0d0;
        }

        .favorite-btn {
            width: 32px;
            height: 32px;
            min-width: 32px;
            background: transparent;
            color: #ff6b6b;
            border: 1px solid #ff6b6b;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: all 0.3s ease;
        }

        .favorite-btn:hover {
            background: #fff5f5;
            transform: scale(1.1);
        }

        .favorite-btn.active {
            background: #ff6b6b;
            color: white;
        }

        .favorite-icon {
            font-size: 16px;
        }

        .bottom-section {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: #fff;
            padding: 10px 15px;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.08);
            z-index: 100;
            display: flex;
            align-items: center;
        }

        .bottom-section .bottom-container {
            max-width: 1920px;
            width: 100%;
            margin: 0 auto;
            display: flex;
            gap: 10px;
        }

        .publish-btn {
            flex: 1;
            height: 50px;
            background: #4a90e2;
            color: #fff;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }

        .publish-btn:hover {
            background: #357abd;
        }

        .publish-btn:active {
            background: #2a6496;
        }

        .my-btn {
            flex: 1;
            height: 50px;
            background: #52c41a;
            color: #fff;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }

        .my-btn:hover {
            background: #45a816;
        }

        .my-btn:active {
            background: #389e0d;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }

        .modal-content {
            background: #fff;
            width: 100%;
            max-width: 500px;
            margin: 20px;
            border-radius: 12px;
            overflow: hidden;
        }

        .modal-header {
            padding: 15px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            border-bottom: 1px solid #f0f0f0;
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 10;
        }

        .modal-body {
            padding: 15px;
        }

        .modal-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .modal-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .section-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .image-upload-container {
            display: flex;
            gap: 10px;
        }

        .image-upload {
            flex: 1;
            aspect-ratio: 1;
            border: 2px dashed #d0d0d0;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: border-color 0.2s;
        }

        .image-upload:hover {
            border-color: #4a90e2;
        }

        .image-upload.has-image {
            border-style: solid;
        }

        .image-upload input {
            display: none;
        }

        .image-upload-text {
            font-size: 12px;
            color: #999;
            text-align: center;
            padding: 5px;
        }

        .image-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .delete-image {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background: rgba(0,0,0,0.6);
            color: #fff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .image-upload.has-image .delete-image {
            display: flex;
        }

        .desc-container {
            display: flex;
            gap: 10px;
        }

        .ai-hint {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
            line-height: 1.4;
        }

        .desc-input {
            flex: 1;
            height: 80px;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            resize: none;
            outline: none;
            font-family: inherit;
        }

        .desc-input:focus {
            border-color: #4a90e2;
        }

        .ai-desc-btn {
            width: 70px;
            height: 80px;
            background: #ff9500;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 5px;
        }

        .ai-desc-btn:hover {
            background: #e68600;
        }

        .ai-desc-btn:active {
            background: #cc7700;
        }

        .ai-desc-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .ai-price-btn {
            width: 90px;
            height: 30px;
            background: #4CAF50;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 0 10px;
            margin-left: 10px;
        }

        .ai-price-btn:hover {
            background: #45a049;
        }

        .ai-price-btn:active {
            background: #3d8b40;
        }

        .ai-price-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .price-input-with-btn {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .price-input-with-btn input {
            flex: 1;
        }

        .price-input-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .price-input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .price-input-wrapper label {
            font-size: 13px;
            color: #666;
            min-width: 100px;
        }

        .price-input {
            flex: 1;
            height: 40px;
            padding: 0 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
        }

        .price-input:focus {
            border-color: #4a90e2;
        }

        .ai-price-btn {
            width: 100%;
            height: 40px;
            background: #ff9500;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 5px;
        }

        .ai-price-btn:hover {
            background: #e68600;
        }

        .ai-price-btn:active {
            background: #cc7700;
        }

        .ai-price-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #4a90e2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .contact-input {
            width: 100%;
            height: 40px;
            padding: 0 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
        }

        .contact-input:focus {
            border-color: #4a90e2;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            padding: 15px;
            border-top: 1px solid #f0f0f0;
        }

        .confirm-btn {
            flex: 1;
            height: 44px;
            background: #52c41a;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }

        .confirm-btn:hover {
            background: #45a816;
        }

        .confirm-btn:active {
            background: #389e0d;
        }

        .confirm-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .cancel-btn {
            flex: 1;
            height: 44px;
            background: #f0f0f0;
            color: #666;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .cancel-btn:hover {
            background: #e0e0e0;
        }

        .cancel-btn:active {
            background: #d0d0d0;
        }

        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .image-modal.active {
            display: flex;
        }

        .image-modal-content {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        .close-image-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.3);
            color: #fff;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-image-modal:hover {
            background: rgba(255,255,255,0.5);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            font-size: 14px;
        }

        .error-msg {
            color: #ff4d4f;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .error-msg.show {
            display: block;
        }

        .info-item {
            display: flex;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-label {
            font-size: 14px;
            color: #666;
            min-width: 100px;
        }

        .info-value {
            font-size: 14px;
            color: #333;
            font-weight: bold;
        }

        .my-goods-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .my-goods-item {
            padding: 12px;
            border: 1px solid #f0f0f0;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .my-goods-name {
            font-size: 15px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .my-goods-price {
            font-size: 14px;
            color: #4a90e2;
            margin-bottom: 5px;
        }

        .my-goods-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .edit-btn {
            flex: 1;
            height: 32px;
            background: #4a90e2;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
        }

        .delete-btn {
            flex: 1;
            height: 32px;
            background: #ff4d4f;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
        }

        @media (max-width: 374px) {
            .search-section {
                padding: 8px 10px;
            }

            .search-input {
                font-size: 13px;
            }

            .goods-section {
                padding: 10px;
            }
        }

        @media (min-width: 1920px) {
            .goods-section {
                padding: 20px;
            }

            .goods-grid {
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="search-section">
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢æƒ³è¦çš„æ ¡å›­é—²ç½®">
                <button class="search-btn" id="searchBtn">æœç´¢</button>
            </div>
        </div>

        <div class="goods-section">
            <div class="goods-grid" id="goodsGrid"></div>
        </div>

        <div class="bottom-section">
            <div class="bottom-container">
                <button class="publish-btn" id="publishBtn">æˆ‘è¦å‡ºå”®</button>
                <button class="my-btn" id="myBtn">æˆ‘çš„</button>
            </div>
        </div>
    </div>

    <div class="modal" id="publishModal">
        <div class="modal-content">
            <div class="modal-header">å‘å¸ƒé—²ç½®</div>
            <div class="modal-body">
                <div class="modal-section">
                    <div class="section-title">å•†å“å›¾ç‰‡ï¼ˆå¿…å¡«ï¼Œ3å¼ ï¼‰</div>
                    <div class="image-upload-container">
                        <div class="image-upload" id="upload1" onclick="selectImage(0)">
                            <input type="file" accept="image/*" id="imageInput0" onchange="handleImageUpload(0, event)">
                            <span class="image-upload-text">ç‚¹å‡»æ‹ç…§/é€‰å›¾</span>
                            <button class="delete-image" onclick="deleteImage(0, event)">Ã—</button>
                        </div>
                        <div class="image-upload" id="upload2" onclick="selectImage(1)">
                            <input type="file" accept="image/*" id="imageInput1" onchange="handleImageUpload(1, event)">
                            <span class="image-upload-text">ç‚¹å‡»æ‹ç…§/é€‰å›¾</span>
                            <button class="delete-image" onclick="deleteImage(1, event)">Ã—</button>
                        </div>
                        <div class="image-upload" id="upload3" onclick="selectImage(2)">
                            <input type="file" accept="image/*" id="imageInput2" onchange="handleImageUpload(2, event)">
                            <span class="image-upload-text">ç‚¹å‡»æ‹ç…§/é€‰å›¾</span>
                            <button class="delete-image" onclick="deleteImage(2, event)">Ã—</button>
                        </div>
                    </div>
                    <div class="error-msg" id="imageError">è¯·ä¸Šä¼ 3å¼ å•†å“å›¾ç‰‡</div>
                </div>

                <div class="modal-section">
                    <div class="section-title">å•†å“å“ç±»ï¼ˆå¿…å¡«ï¼‰</div>
                    <select class="contact-input" id="categoryInput" onchange="validateForm()">
                        <option value="">è¯·é€‰æ‹©å•†å“å“ç±»</option>
                        <option value="shoes">é‹å­</option>
                        <option value="clothing">æœè£…</option>
                        <option value="jewelry">é¦–é¥°</option>
                        <option value="electronics">ç”µå­äº§å“</option>
                        <option value="sports">è¿åŠ¨è£…å¤‡</option>
                        <option value="daily">ç”Ÿæ´»ç”¨å“</option>
                        <option value="books">ä¹¦ç±</option>
                        <option value="furniture">å®¶å…·</option>
                        <option value="other">å…¶ä»–</option>
                    </select>
                    <div class="error-msg" id="categoryError">è¯·é€‰æ‹©å•†å“å“ç±»</div>
                </div>

                <div class="modal-section">
                    <div class="section-title">ç‰©å“åç§°ï¼ˆå¿…å¡«ï¼‰</div>
                    <input type="text" class="contact-input" id="nameInput" placeholder="è¾“å…¥ç‰©å“åç§°ï¼Œå¦‚ï¼šiPhone 15ã€è‡ªè¡Œè½¦ã€ä¹¦ç±ç­‰" oninput="validateForm()">
                    <div class="error-msg" id="nameError">è¯·å¡«å†™ç‰©å“åç§°</div>
                </div>

                <div class="modal-section">
                    <div class="section-title">å•†å“æè¿°ï¼ˆé€‰å¡«ï¼‰</div>
                    <div class="desc-container">
                        <textarea class="desc-input" id="descInput" placeholder="è‡ªå®šä¹‰æè¿°ï¼ˆå“ç±»/æˆè‰²/ç‘•ç–µ/ä½¿ç”¨æƒ…å†µï¼Œé€‰å¡«ï¼‰"></textarea>
                        <button class="ai-desc-btn" id="aiDescBtn" onclick="analyzeGoods()">AIè¯†åˆ«å•†å“ä¿¡æ¯</button>
                        <span class="loading-spinner" id="aiDescLoading" style="display: none;"></span>
                    </div>
                    <div class="ai-hint">ğŸ’¡ æç¤ºï¼šaiè¯†åˆ«ä¿¡æ¯ä¸ä¸€å®šå‡†ç¡®ï¼Œè¯·æ ¹æ®å®é™…è¿›è¡Œéƒ¨åˆ†ä¿®æ”¹ï¼è¯¦ç»†çš„å•†å“æè¿°æœ‰åŠ©äºå¿«é€Ÿæˆäº¤ï¼</div>
                </div>

                <div class="modal-section">
                    <div class="section-title">ä»·æ ¼è®¾ç½®ï¼ˆå¿…å¡«ï¼‰</div>
                    <div class="price-input-container">
                        <div class="price-input-wrapper">
                            <label>å•†å“åŸä»·ï¼ˆå…ƒï¼‰</label>
                            <input type="text" class="price-input" id="originalPriceInput" placeholder="è¾“å…¥è´­ä¹°æ—¶çš„ä»·æ ¼ï¼ˆå¿…å¡«ï¼‰" oninput="validatePriceInput(this)">
                        </div>
                        <div class="price-input-wrapper">
                            <label>æœ€ç»ˆå”®ä»·ï¼ˆå…ƒï¼‰</label>
                            <div class="price-input-with-btn">
                                <input type="text" class="price-input" id="salePriceInput" placeholder="å»ºè®®å”®ä»·ï¼šåŸä»·çš„50%-80%ï¼ˆå¿…å¡«ï¼‰" oninput="validatePriceInput(this)">
                                <button class="ai-price-btn" id="aiPriceBtn" onclick="generateSuggestedPrice()">AIæ™ºèƒ½å®šä»·</button>
                                <span class="loading-spinner" id="aiPriceLoading" style="display: none;"></span>
                            </div>
                        </div>
                    </div>
                    <div class="error-msg" id="priceError">æœ€ç»ˆå”®ä»·ä¸å¯é«˜äºåŸä»·</div>
                </div>

                <div class="modal-section">
                    <div class="section-title">è”ç³»æ–¹å¼ï¼ˆå¿…å¡«ï¼‰</div>
                    <input type="text" class="contact-input" id="contactInput" placeholder="å¡«å†™å¾®ä¿¡/QQï¼Œæ–¹ä¾¿ä¹°å®¶è”ç³»" oninput="validateContactInput(this)">
                    <div class="error-msg" id="contactError">è¯·å¡«å†™è”ç³»æ–¹å¼</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="confirm-btn" id="confirmBtn" onclick="confirmPublish()">ç¡®è®¤å‘å¸ƒ</button>
                <button class="cancel-btn" onclick="closeModal()">å–æ¶ˆå‘å¸ƒ</button>
            </div>
        </div>
    </div>

    <div class="modal" id="goodsDetailModal">
        <div class="modal-content goods-detail-content">
            <div class="modal-header">å•†å“è¯¦æƒ…</div>
            <div class="modal-body">
                <div class="goods-detail-section">
                    <div class="goods-detail-name" id="detailName"></div>
                    <div class="goods-detail-category" id="detailCategory"></div>
                </div>
                <div class="goods-detail-section">
                    <div class="goods-detail-title">å•†å“å›¾ç‰‡</div>
                    <div class="goods-detail-images" id="detailImages"></div>
                </div>
                <div class="goods-detail-section">
                    <div class="goods-detail-title">å•†å“æè¿°</div>
                    <div class="goods-detail-desc" id="detailDesc"></div>
                </div>
                <div class="goods-detail-section">
                    <div class="goods-detail-title">ä»·æ ¼ä¿¡æ¯</div>
                    <div class="goods-detail-price">
                        <span class="detail-sale-price">Â¥<span id="detailSalePrice"></span></span>
                        <span class="detail-original-price">åŸä»·ï¼šÂ¥<span id="detailOriginalPrice"></span></span>
                    </div>
                </div>
                <div class="goods-detail-section">
                    <div class="goods-detail-title">è”ç³»æ–¹å¼</div>
                    <div class="goods-detail-contact">
                        <span class="detail-contact-text" id="detailContact"></span>
                        <button class="copy-btn" onclick="copyContact(document.getElementById('detailContact').textContent)">å¤åˆ¶</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn" onclick="closeGoodsDetailModal()" style="flex: 1;">å…³é—­</button>
            </div>
        </div>
    </div>

    <div class="image-modal" id="imageModal">
        <button class="close-image-modal" onclick="closeImageModal()">Ã—</button>
        <img class="image-modal-content" id="imageModalContent">
    </div>

    <div class="modal" id="myModal">
        <div class="modal-content">
            <div class="modal-header">æˆ‘çš„</div>
            <div class="modal-body">
                <div class="modal-section">
                    <div class="section-title">ä¸ªäººä¿¡æ¯</div>
                    <div class="info-item">
                        <span class="info-label">ç”¨æˆ·åï¼š</span>
                        <span class="info-value" id="username">è®¿å®¢</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">å‘å¸ƒæ•°é‡ï¼š</span>
                        <span class="info-value" id="publishCount">0</span>
                    </div>
                </div>

                <div class="modal-section">
                    <div class="section-title">æˆ‘çš„æ”¶è—</div>
                    <div id="favoriteList" class="my-goods-list"></div>
                </div>

                <div class="modal-section">
                    <div class="section-title">æˆ‘çš„å‡ºå”®è®°å½•</div>
                    <div id="myGoodsList" class="my-goods-list"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="cancel-btn" onclick="closeMyModal()" style="flex: 1;">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';

        const uploadedImages = [null, null, null];
        const imageBase64List = ['', '', ''];

        let cachedGoodsList = [];
        let currentEditGoodsId = null;
        let favoriteGoods = JSON.parse(localStorage.getItem('favoriteGoods') || '[]');

        async function loadGoods() {
            try {
                const response = await fetch(`${API_BASE}/goods/list`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                });

                const result = await response.json();
                if (result.code === 200) {
                    cachedGoodsList = result.data;
                    return result.data;
                } else {
                    console.error('è·å–å•†å“åˆ—è¡¨å¤±è´¥:', result.msg);
                    return [];
                }
            } catch (error) {
                console.error('è·å–å•†å“åˆ—è¡¨å¤±è´¥:', error);
                return cachedGoodsList;
            }
        }

        function saveGoods(goodsList) {
            cachedGoodsList = goodsList;
        }

        function renderGoods(goodsList) {
            const goodsGrid = document.getElementById('goodsGrid');
            
            if (goodsList.length === 0) {
                goodsGrid.innerHTML = '<div class="empty-state">æš‚æ— ç›¸å…³æ ¡å›­é—²ç½®</div>';
                return;
            }

            goodsGrid.innerHTML = goodsList.map((goods, index) => `
                <div class="goods-card">
                    <div class="goods-tag">æœ¬æ ¡é—²ç½®</div>
                    <div class="goods-name">${goods.name || 'æœªå‘½å'}</div>
                    <div class="goods-images" onclick="viewImages(${index})">
                        <img class="goods-image" src="${goods.imgBase64List[0]}" alt="å•†å“å›¾ç‰‡">
                        ${goods.imgBase64List[1] ? `<img class="goods-image" src="${goods.imgBase64List[1]}" alt="å•†å“å›¾ç‰‡">` : ''}
                        ${goods.imgBase64List[2] ? `<img class="goods-image" src="${goods.imgBase64List[2]}" alt="å•†å“å›¾ç‰‡">` : ''}
                    </div>
                    <div class="goods-desc" onclick="viewGoodsDetail(${index})">${truncateText(goods.desc, 60)}</div>
                    <div class="goods-price">
                        <span class="sale-price">Â¥${goods.salePrice}</span>
                        <span class="original-price">åŸä»·ï¼šÂ¥${goods.originalPrice}</span>
                    </div>
                    <div class="goods-contact">
                        <span class="contact-text">è”ç³»ï¼š${goods.contact}</span>
                        <button class="copy-btn" onclick="copyContact('${goods.contact}')">å¤åˆ¶</button>
                        <button class="favorite-btn ${isFavorite(goods.id) ? 'active' : ''}" onclick="toggleFavorite('${goods.id}')">
                            <span class="favorite-icon">${isFavorite(goods.id) ? 'â¤ï¸' : 'ğŸ¤'}</span>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function truncateText(text, maxLength) {
            if (!text) return 'æš‚æ— æè¿°';
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }

        function copyContact(contact) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(contact).then(() => {
                    alert('è”ç³»æ–¹å¼å·²å¤åˆ¶');
                }).catch(() => {
                    fallbackCopy(contact);
                });
            } else {
                fallbackCopy(contact);
            }
        }

        function fallbackCopy(contact) {
            const textarea = document.createElement('textarea');
            textarea.value = contact;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert('è”ç³»æ–¹å¼å·²å¤åˆ¶');
        }

        function isFavorite(goodsId) {
            return favoriteGoods.some(fav => fav.goodsId === goodsId);
        }

        function toggleFavorite(goodsId) {
            const index = favoriteGoods.findIndex(fav => fav.goodsId === goodsId);
            if (index > -1) {
                favoriteGoods.splice(index, 1);
            } else {
                const goods = cachedGoodsList.find(g => g.id === goodsId);
                if (goods) {
                    favoriteGoods.push({
                        goodsId: goodsId,
                        name: goods.name,
                        salePrice: goods.salePrice,
                        originalPrice: goods.originalPrice,
                        contact: goods.contact,
                        imgBase64List: goods.imgBase64List,
                        desc: goods.desc,
                        favoriteTime: new Date().toISOString()
                    });
                }
            }
            saveFavorites();
            renderGoods(cachedGoodsList);
        }

        function saveFavorites() {
            localStorage.setItem('favoriteGoods', JSON.stringify(favoriteGoods));
        }

        async function viewImages(index) {
            const goodsList = await loadGoods();
            const goods = goodsList[index];
            const imageModal = document.getElementById('imageModal');
            const imageModalContent = document.getElementById('imageModalContent');
            
            imageModalContent.src = goods.imgBase64List[0];
            imageModal.classList.add('active');
        }

        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
        }

        async function viewGoodsDetail(index) {
            const goodsList = await loadGoods();
            const goods = goodsList[index];
            
            document.getElementById('detailName').textContent = goods.name || 'æœªå‘½å';
            document.getElementById('detailCategory').textContent = goods.category || 'å…¶ä»–';
            document.getElementById('detailDesc').textContent = goods.desc || 'æš‚æ— æè¿°';
            document.getElementById('detailSalePrice').textContent = goods.salePrice || '0';
            document.getElementById('detailOriginalPrice').textContent = goods.originalPrice || '0';
            document.getElementById('detailContact').textContent = goods.contact || 'æš‚æ— ';
            
            const imagesContainer = document.getElementById('detailImages');
            imagesContainer.innerHTML = goods.imgBase64List
                .filter(img => img)
                .map(img => `<img class="detail-image" src="${img}" alt="å•†å“å›¾ç‰‡">`)
                .join('');
            
            document.getElementById('goodsDetailModal').classList.add('active');
        }

        function closeGoodsDetailModal() {
            document.getElementById('goodsDetailModal').classList.remove('active');
        }

        function selectImage(index) {
            document.getElementById(`imageInput${index}`).click();
        }

        function handleImageUpload(index, event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    const maxWidth = 800;

                    if (width > maxWidth) {
                        height = Math.round((height * maxWidth) / width);
                        width = maxWidth;
                    }

                    canvas.width = width;
                    canvas.height = height;

                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);

                    const compressedBase64 = canvas.toDataURL('image/jpeg', 0.8);
                    imageBase64List[index] = compressedBase64;
                    uploadedImages[index] = compressedBase64;

                    const uploadDiv = document.getElementById(`upload${index + 1}`);
                    uploadDiv.classList.add('has-image');
                    uploadDiv.innerHTML = `
                        <img class="image-preview" src="${compressedBase64}" alt="å•†å“å›¾ç‰‡">
                        <button class="delete-image" onclick="deleteImage(${index}, event)">Ã—</button>
                    `;

                    validateForm();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function deleteImage(index, event) {
            event.stopPropagation();
            imageBase64List[index] = '';
            uploadedImages[index] = null;

            const uploadDiv = document.getElementById(`upload${index + 1}`);
            uploadDiv.classList.remove('has-image');
            uploadDiv.innerHTML = `
                <input type="file" accept="image/*" id="imageInput${index}" onchange="handleImageUpload(${index}, event)">
                <span class="image-upload-text">ç‚¹å‡»æ‹ç…§/é€‰å›¾</span>
                <button class="delete-image" onclick="deleteImage(${index}, event)">Ã—</button>
            `;

            validateForm();
        }

        function validatePriceInput(input) {
            input.value = input.value.replace(/[^\d]/g, '');
            validateForm();
        }

        function validateContactInput(input) {
            input.value = input.value.replace(/[^a-zA-Z0-9_]/g, '');
            validateForm();
        }

        function validateForm() {
            const hasAllImages = imageBase64List.every(img => img !== '');
            const category = document.getElementById('categoryInput').value;
            const originalPrice = document.getElementById('originalPriceInput').value;
            const salePrice = document.getElementById('salePriceInput').value;
            const contact = document.getElementById('contactInput').value;

            const imageError = document.getElementById('imageError');
            const categoryError = document.getElementById('categoryError');
            const priceError = document.getElementById('priceError');
            const contactError = document.getElementById('contactError');
            const confirmBtn = document.getElementById('confirmBtn');
            const aiPriceBtn = document.getElementById('aiPriceBtn');

            imageError.classList.remove('show');
            categoryError.classList.remove('show');
            priceError.classList.remove('show');
            contactError.classList.remove('show');

            let isValid = true;

            if (!hasAllImages) {
                imageError.classList.add('show');
                isValid = false;
            }

            if (!category) {
                categoryError.classList.add('show');
                isValid = false;
            }

            if (originalPrice && salePrice && parseFloat(salePrice) > parseFloat(originalPrice)) {
                priceError.classList.add('show');
                isValid = false;
            }

            if (!contact) {
                contactError.classList.add('show');
                isValid = false;
            }

            if (!originalPrice || !salePrice) {
                isValid = false;
            }

            aiPriceBtn.disabled = !originalPrice;
            confirmBtn.disabled = !isValid;
        }

        async function analyzeGoods() {
            const name = document.getElementById('nameInput').value;
            const category = document.getElementById('categoryInput').value;
            const hasAllImages = imageBase64List.every(img => img !== '');
            
            if (!category) {
                alert('è¯·å…ˆé€‰æ‹©å•†å“å“ç±»');
                return;
            }
            
            if (!name) {
                alert('è¯·å…ˆå¡«å†™ç‰©å“åç§°');
                return;
            }
            
            if (!hasAllImages) {
                alert('è¯·å…ˆä¸Šä¼ 3å¼ å•†å“å›¾ç‰‡');
                return;
            }

            const btn = document.getElementById('aiDescBtn');
            const loadingSpinner = document.getElementById('aiDescLoading');
            btn.disabled = true;
            btn.textContent = 'è¯†åˆ«ä¸­...';
            if (loadingSpinner) loadingSpinner.style.display = 'inline-block';

            try {
                const productInfoResponse = await fetch('http://localhost:3000/api/product/info', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        productName: name,
                        category: category
                    })
                });

                const productInfoResult = await productInfoResponse.json();
                
                let analysis = `ğŸ“¦ å•†å“åç§°ï¼š${name}\n\n`;

                if (productInfoResult.success && productInfoResult.data) {
                    const info = productInfoResult.data;
                    analysis += `ğŸ·ï¸ å“ç‰Œï¼š${info.brand}\n`;
                    if (info.model) {
                        analysis += `ğŸ“± å‹å·ï¼š${info.model}\n`;
                    }
                    if (info.releaseDate) {
                        analysis += `ğŸ“… å‘å¸ƒæ—¶é—´ï¼š${info.releaseDate}\n`;
                    }
                    if (info.price) {
                        analysis += `ğŸ’° å®˜æ–¹ä»·æ ¼ï¼š${info.price}\n`;
                    }
                    
                    if (info.specs && Object.keys(info.specs).length > 0) {
                        analysis += `\nğŸ“‹ ä¸»è¦åŠŸèƒ½å‚æ•°ï¼š\n`;
                        for (const [key, value] of Object.entries(info.specs)) {
                            analysis += `  â€¢ ${key}ï¼š${value}\n`;
                        }
                    }
                } else {
                    analysis += `âš ï¸ æœªæ‰¾åˆ°è¯¥å•†å“ä¿¡æ¯\n`;
                }

                const categoryPrompts = {
                    'shoes': `ã€å¿…å¡«ã€‘\nâ€¢ æˆè‰²ï¼ˆå¦‚ï¼šå…¨æ–°/ä¹æˆæ–°/å…«æˆæ–°ï¼‰\nâ€¢ é‹ç \nâ€¢ ç£¨æŸæƒ…å†µï¼ˆé‹åº•/é‹é¢ï¼‰\nâ€¢ è´­ä¹°æ—¶é—´\n\nã€é€‰å¡«ã€‘\nâ€¢ åŸç›’/åŸé‹å¸¦\nâ€¢ æ˜¯å¦æœ‰å¼‚å‘³`,
                    'clothing': `ã€å¿…å¡«ã€‘\nâ€¢ æˆè‰²ï¼ˆå¦‚ï¼šå…¨æ–°/ä¹æˆæ–°/å…«æˆæ–°ï¼‰\nâ€¢ å°ºç ï¼ˆS/M/L/XLç­‰ï¼‰\nâ€¢ ç‘•æŸæƒ…å†µï¼ˆæ±¡æ¸/ç ´æŸ/èµ·çƒç­‰ï¼‰\nâ€¢ è´­ä¹°æ—¶é—´\n\nã€é€‰å¡«ã€‘\nâ€¢ å“ç‰Œ\nâ€¢ é€‚åˆå­£èŠ‚`,
                    'jewelry': `ã€å¿…å¡«ã€‘\nâ€¢ æˆè‰²ï¼ˆå¦‚ï¼šå…¨æ–°/ä¹æˆæ–°/å…«æˆæ–°ï¼‰\nâ€¢ æè´¨ï¼ˆå¦‚ï¼šçº¯é“¶/18Ké‡‘/é’»çŸ³ï¼‰\nâ€¢ ç‘•æŸæƒ…å†µï¼ˆåˆ’ç—•/æ°§åŒ–/å˜å½¢ï¼‰\nâ€¢ è´­ä¹°æ—¶é—´\n\nã€é€‰å¡«ã€‘\nâ€¢ åŸç›’/è¯ä¹¦\nâ€¢ å°ºå¯¸`,
                    'electronics': `ã€å¿…å¡«ã€‘\nâ€¢ æˆè‰²ï¼ˆå¦‚ï¼šå…¨æ–°/ä¹æˆæ–°/å…«æˆæ–°ï¼‰\nâ€¢ åŠŸèƒ½æ˜¯å¦å®Œå¥½\nâ€¢ æœ‰æ— ç‘•ç–µæˆ–æŸå\nâ€¢ ä½¿ç”¨æ—¶é•¿\n\nã€é€‰å¡«ã€‘\nâ€¢ è´­ä¹°æ¸ é“å’Œæ—¶é—´\nâ€¢ é…ä»¶æ˜¯å¦é½å…¨\nâ€¢ ä¿ä¿®æƒ…å†µ`,
                    'sports': `ã€å¿…å¡«ã€‘\nâ€¢ æˆè‰²ï¼ˆå¦‚ï¼šå…¨æ–°/ä¹æˆæ–°/å…«æˆæ–°ï¼‰\nâ€¢ åŠŸèƒ½æ˜¯å¦å®Œå¥½\nâ€¢ ä½¿ç”¨æ¬¡æ•°/æ—¶é•¿\nâ€¢ ç£¨æŸæƒ…å†µ\n\nã€é€‰å¡«ã€‘\nâ€¢ é€‚ç”¨åœºæ™¯\nâ€¢ ä¿å…»æƒ…å†µ`,
                    'daily': `ã€å¿…å¡«ã€‘\nâ€¢ æˆè‰²ï¼ˆå¦‚ï¼šå…¨æ–°/ä¹æˆæ–°/å…«æˆæ–°ï¼‰\nâ€¢ ä¸»è¦åŠŸèƒ½æ˜¯å¦å®Œå¥½\nâ€¢ ä½¿ç”¨æ¬¡æ•°/æ—¶é•¿\nâ€¢ æ¸…æ´ç¨‹åº¦\n\nã€é€‰å¡«ã€‘\nâ€¢ æ˜¯å¦æœ‰å¼‚å‘³\nâ€¢ åŒ…è£…æƒ…å†µ`,
                    'books': `ã€å¿…å¡«ã€‘\nâ€¢ æˆè‰²ï¼ˆå¦‚ï¼šå…¨æ–°/ä¹æˆæ–°/å…«æˆæ–°ï¼‰\nâ€¢ æœ‰æ— ç¬”è®°/åˆ’çº¿\nâ€¢ ç‘•æŸæƒ…å†µï¼ˆæ±¡æ¸/ç ´æŸ/ç¼ºé¡µï¼‰\nâ€¢ è´­ä¹°æ—¶é—´\n\nã€é€‰å¡«ã€‘\nâ€¢ ç‰ˆæœ¬ä¿¡æ¯\nâ€¢ æ˜¯å¦æœ‰åŸåŒ…è£…`,
                    'furniture': `ã€å¿…å¡«ã€‘\nâ€¢ æˆè‰²ï¼ˆå¦‚ï¼šå…¨æ–°/ä¹æˆæ–°/å…«æˆæ–°ï¼‰\nâ€¢ å°ºå¯¸è§„æ ¼\nâ€¢ ç£¨æŸæƒ…å†µ\nâ€¢ è´­ä¹°æ—¶é—´\n\nã€é€‰å¡«ã€‘\nâ€¢ æ˜¯å¦å¯æ‹†å¸\nâ€¢ æ¬è¿æƒ…å†µ`,
                    'other': `ã€å¿…å¡«ã€‘\nâ€¢ æˆè‰²ï¼ˆå¦‚ï¼šå…¨æ–°/ä¹æˆæ–°/å…«æˆæ–°ï¼‰\nâ€¢ åŠŸèƒ½æ˜¯å¦å®Œå¥½\nâ€¢ æœ‰æ— ç‘•ç–µæˆ–æŸå\nâ€¢ ä½¿ç”¨æ—¶é•¿\n\nã€é€‰å¡«ã€‘\nâ€¢ è´­ä¹°æ¸ é“å’Œæ—¶é—´\nâ€¢ é…ä»¶æ˜¯å¦é½å…¨\nâ€¢ ä¿ä¿®æƒ…å†µ\nâ€¢ å…¶ä»–éœ€è¦è¯´æ˜çš„æƒ…å†µ`
                };

                analysis += `\nğŸ“ è¯·æ ¹æ®ä»¥ä¸Šä¿¡æ¯è¡¥å……å•†å“è¯¦æƒ…ï¼š\n`;
                analysis += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
                analysis += categoryPrompts[category] || categoryPrompts['other'];
                analysis += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
                analysis += `\nğŸ’¡ æç¤ºï¼šè¯¦ç»†çš„å•†å“æè¿°æœ‰åŠ©äºå¿«é€Ÿæˆäº¤ï¼`;

                document.getElementById('descInput').value = analysis;
            } catch (error) {
                console.error('AIè¯†åˆ«å¤±è´¥:', error);
                alert('AIè¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•');
            } finally {
                btn.disabled = false;
                btn.textContent = 'AIè¯†åˆ«å•†å“ä¿¡æ¯';
                if (loadingSpinner) loadingSpinner.style.display = 'none';
            }
        }

        async function generateDesc() {
            const hasAllImages = imageBase64List.every(img => img !== '');
            if (!hasAllImages) {
                alert('è¯·å…ˆä¸Šä¼ 3å¼ å•†å“å›¾ç‰‡');
                return;
            }

            const btn = document.getElementById('aiDescBtn');
            const loadingSpinner = document.getElementById('aiDescLoading');
            btn.disabled = true;
            btn.textContent = 'ç”Ÿæˆä¸­...';
            if (loadingSpinner) loadingSpinner.style.display = 'inline-block';

            try {
                const ocrResponse = await fetch('http://localhost:3000/api/ocr', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        imgBase64List: imageBase64List
                    })
                });

                const ocrResult = await ocrResponse.json();
                if (!ocrResult.success) {
                    throw new Error(ocrResult.msg || 'OCRè¯†åˆ«å¤±è´¥');
                }

                const descResponse = await fetch('http://localhost:3000/api/ai/desc', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ocrResult: ocrResult.data
                    })
                });

                const descResult = await descResponse.json();
                if (descResult.success) {
                    document.getElementById('descInput').value = descResult.data;
                } else {
                    throw new Error(descResult.msg || 'ç”Ÿæˆæè¿°å¤±è´¥');
                }
            } catch (error) {
                console.error('AIæè¿°ç”Ÿæˆå¤±è´¥:', error);
                alert('AIå¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•');
            } finally {
                btn.disabled = false;
                btn.textContent = 'AIå¸®å†™';
                if (loadingSpinner) loadingSpinner.style.display = 'none';
            }
        }

        async function generateSuggestedPrice() {
            const originalPrice = document.getElementById('originalPriceInput').value;
            const desc = document.getElementById('descInput').value;

            if (!originalPrice || isNaN(parseFloat(originalPrice))) {
                alert('è¯·å…ˆå¡«å†™å•†å“åŸä»·');
                return;
            }

            if (!desc || desc.trim() === '') {
                alert('è¯·å…ˆå¡«å†™å•†å“æè¿°ï¼ŒåŒ…æ‹¬ï¼š\nâ€¢ æˆè‰²\nâ€¢ åŠŸèƒ½æ˜¯å¦å®Œå¥½\nâ€¢ ç‘•ç–µ\nâ€¢ ä½¿ç”¨æ—¶é•¿');
                return;
            }

            const hasRequiredInfo = checkRequiredInfo(desc);
            if (!hasRequiredInfo) {
                alert('å•†å“æè¿°ä¿¡æ¯ä¸å®Œæ•´ï¼Œè¯·ç¡®ä¿å¡«å†™ä»¥ä¸‹å¿…å¡«ä¿¡æ¯ï¼š\nâ€¢ æˆè‰²\nâ€¢ åŠŸèƒ½æ˜¯å¦å®Œå¥½\nâ€¢ ç‘•ç–µ\nâ€¢ ä½¿ç”¨æ—¶é•¿');
                return;
            }

            const btn = document.getElementById('aiPriceBtn');
            const loadingSpinner = document.getElementById('aiPriceLoading');
            btn.disabled = true;
            btn.textContent = 'å®šä»·ä¸­...';
            if (loadingSpinner) loadingSpinner.style.display = 'inline-block';

            try {
                const response = await fetch('http://localhost:3000/api/product/price', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        originalPrice: parseFloat(originalPrice),
                        desc: desc
                    })
                });

                const result = await response.json();
                if (result.success) {
                    document.getElementById('salePriceInput').value = result.data;
                    alert(`AIå»ºè®®å”®ä»·ï¼š${result.data}å…ƒ`);
                } else {
                    throw new Error(result.msg || 'å®šä»·å¤±è´¥');
                }
            } catch (error) {
                console.error('AIå®šä»·å¤±è´¥:', error);
                alert('AIå®šä»·å¤±è´¥ï¼Œè¯·é‡è¯•');
            } finally {
                btn.disabled = false;
                btn.textContent = 'AIæ™ºèƒ½å®šä»·';
                if (loadingSpinner) loadingSpinner.style.display = 'none';
            }
        }

        function checkRequiredInfo(desc) {
            const lowerDesc = desc.toLowerCase();
            const hasCondition = /æˆè‰²|å…¨æ–°|ä¹æˆæ–°|å…«æˆæ–°|ä¸ƒæˆæ–°|å…­æˆæ–°/.test(desc);
            const hasFunction = /åŠŸèƒ½|å®Œå¥½|æ­£å¸¸|å¯ç”¨/.test(desc);
            const hasDefect = /ç‘•ç–µ|æŸå|ç ´æŸ|åˆ’ç—•|æ±¡æ¸|ç£¨æŸ|æ— ç‘•ç–µ|æ— æŸå|å®Œå¥½/.test(desc);
            const hasUsage = /ä½¿ç”¨|æ—¶é•¿|æ—¶é—´|å¤šä¹…|å¹´|æœˆ/.test(desc);

            return hasCondition && hasFunction && hasDefect && hasUsage;
        }

        async function confirmPublish() {
            const name = document.getElementById('nameInput').value;
            const category = document.getElementById('categoryInput').value;
            const desc = document.getElementById('descInput').value;
            const originalPrice = document.getElementById('originalPriceInput').value;
            const salePrice = document.getElementById('salePriceInput').value;
            const contact = document.getElementById('contactInput').value;

            const goodsData = {
                name: name,
                category: category,
                imgBase64List: [...imageBase64List],
                desc: desc,
                originalPrice: parseFloat(originalPrice),
                salePrice: parseFloat(salePrice),
                contact: contact
            };

            try {
                let response;
                if (currentEditGoodsId) {
                    goodsData.id = currentEditGoodsId;
                    response = await fetch(`${API_BASE}/goods/update`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(goodsData)
                    });
                } else {
                    response = await fetch(`${API_BASE}/goods/publish`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(goodsData)
                    });
                }

                const result = await response.json();
                if (result.code === 200) {
                    const goodsList = await loadGoods();
                    renderGoods(goodsList);
                    closeModal();
                } else {
                    alert(currentEditGoodsId ? 'ä¿®æ”¹å¤±è´¥ï¼š' + result.msg : 'å‘å¸ƒå¤±è´¥ï¼š' + result.msg);
                }
            } catch (error) {
                console.error(currentEditGoodsId ? 'ä¿®æ”¹å¤±è´¥:' : 'å‘å¸ƒå¤±è´¥:', error);
                alert(currentEditGoodsId ? 'ä¿®æ”¹å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥' : 'å‘å¸ƒå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }

        function closeModal() {
            document.getElementById('publishModal').classList.remove('active');
            if (!currentEditGoodsId) {
                resetForm();
            }
        }

        function resetForm() {
            document.getElementById('confirmBtn').textContent = 'ç¡®è®¤å‘å¸ƒ';

            for (let i = 0; i < 3; i++) {
                imageBase64List[i] = '';
                uploadedImages[i] = null;
                const uploadDiv = document.getElementById(`upload${i + 1}`);
                uploadDiv.classList.remove('has-image');
                uploadDiv.innerHTML = `
                    <input type="file" accept="image/*" id="imageInput${i}" onchange="handleImageUpload(${i}, event)">
                    <span class="image-upload-text">ç‚¹å‡»æ‹ç…§/é€‰å›¾</span>
                    <button class="delete-image" onclick="deleteImage(${i}, event)">Ã—</button>
                `;
            }

            document.getElementById('nameInput').value = '';
            document.getElementById('descInput').value = '';
            document.getElementById('originalPriceInput').value = '';
            document.getElementById('salePriceInput').value = '';
            document.getElementById('contactInput').value = '';

            document.getElementById('imageError').classList.remove('show');
            document.getElementById('priceError').classList.remove('show');
            document.getElementById('contactError').classList.remove('show');
            document.getElementById('confirmBtn').disabled = true;
        }

        async function searchGoods() {
            const keyword = document.getElementById('searchInput').value.trim();
            const searchBtn = document.getElementById('searchBtn');

            if (!keyword) {
                const goodsList = await loadGoods();
                renderGoods(goodsList);
                return;
            }

            searchBtn.disabled = true;
            searchBtn.textContent = 'æœç´¢ä¸­...';

            try {
                const goodsList = await loadGoods();
                const response = await fetch(`${API_BASE}/ai/matchGoods`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        keyword: keyword,
                        goodsList: goodsList
                    })
                });

                const result = await response.json();
                if (result.code === 200) {
                    renderGoods(result.data);
                } else {
                    alert('æœç´¢å¤±è´¥ï¼š' + result.msg);
                }
            } catch (error) {
                console.error('æœç´¢å¤±è´¥:', error);
                const goodsList = await loadGoods();
                const filtered = goodsList.filter(goods => {
                    const name = goods.name || '';
                    const desc = goods.desc || '';
                    return name.toLowerCase().includes(keyword.toLowerCase()) || desc.toLowerCase().includes(keyword.toLowerCase());
                });
                renderGoods(filtered);
            } finally {
                searchBtn.disabled = false;
                searchBtn.textContent = 'æœç´¢';
            }
        }

        document.getElementById('publishBtn').addEventListener('click', () => {
            currentEditGoodsId = null;
            document.getElementById('publishModal').classList.add('active');
            setTimeout(() => {
                resetForm();
            }, 100);
        });

        document.getElementById('myBtn').addEventListener('click', () => {
            openMyModal();
        });

        document.getElementById('searchBtn').addEventListener('click', searchGoods);

        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchGoods();
            }
        });

        document.getElementById('publishModal').addEventListener('click', (e) => {
            if (e.target.id === 'publishModal') {
                closeModal();
            }
        });

        document.getElementById('myModal').addEventListener('click', (e) => {
            if (e.target.id === 'myModal') {
                closeMyModal();
            }
        });

        document.getElementById('imageModal').addEventListener('click', (e) => {
            if (e.target.id === 'imageModal') {
                closeImageModal();
            }
        });

        window.addEventListener('load', async () => {
            const goodsList = await loadGoods();
            renderGoods(goodsList);
            checkPriceDrop(goodsList);
        });

        function checkPriceDrop(goodsList) {
            if (favoriteGoods.length === 0) return;

            const priceDropGoods = [];
            favoriteGoods.forEach(fav => {
                const currentGoods = goodsList.find(g => g.id === fav.goodsId);
                if (currentGoods && currentGoods.salePrice < fav.salePrice) {
                    priceDropGoods.push({
                        name: fav.name,
                        oldPrice: fav.salePrice,
                        newPrice: currentGoods.salePrice
                    });
                    fav.salePrice = currentGoods.salePrice;
                }
            });

            if (priceDropGoods.length > 0) {
                saveFavorites();
                const message = priceDropGoods.map(g => 
                    `æ‚¨å¿ƒä»ªçš„å•†å“"${g.name}"å·²ç»é™ä»·ï¼Œä»Â¥${g.oldPrice}é™è‡³Â¥${g.newPrice}`
                ).join('\n\n');
                alert(message);
            }
        }

        function openMyModal() {
            document.getElementById('myModal').classList.add('active');
            loadMyGoods();
            loadFavorites();
        }

        function closeMyModal() {
            document.getElementById('myModal').classList.remove('active');
        }

        async function loadMyGoods() {
            const goodsList = await loadGoods();
            document.getElementById('publishCount').textContent = goodsList.length;

            const myGoodsList = document.getElementById('myGoodsList');
            
            if (goodsList.length === 0) {
                myGoodsList.innerHTML = '<div class="empty-state">æš‚æ— å‡ºå”®è®°å½•</div>';
                return;
            }

            myGoodsList.innerHTML = goodsList.map((goods, index) => `
                <div class="my-goods-item">
                    <div class="my-goods-name">${goods.name || 'æœªå‘½å'}</div>
                    <div class="my-goods-price">å”®ä»·ï¼šÂ¥${goods.salePrice}</div>
                    <div class="my-goods-actions">
                        <button class="edit-btn" onclick="editGoods(${index})">ä¿®æ”¹</button>
                        <button class="delete-btn" onclick="deleteGoods('${goods.id}')">ä¸‹æ¶</button>
                    </div>
                </div>
            `).join('');
        }

        function loadFavorites() {
            const favoriteList = document.getElementById('favoriteList');
            
            if (favoriteGoods.length === 0) {
                favoriteList.innerHTML = '<div class="empty-state">æš‚æ— æ”¶è—</div>';
                return;
            }

            favoriteList.innerHTML = favoriteGoods.map((fav, index) => `
                <div class="my-goods-item">
                    <div class="my-goods-name">${fav.name || 'æœªå‘½å'}</div>
                    <div class="my-goods-price">å”®ä»·ï¼šÂ¥${fav.salePrice}</div>
                    <div class="my-goods-actions">
                        <button class="delete-btn" onclick="removeFavorite('${fav.goodsId}')">å–æ¶ˆæ”¶è—</button>
                    </div>
                </div>
            `).join('');
        }

        function removeFavorite(goodsId) {
            const index = favoriteGoods.findIndex(fav => fav.goodsId === goodsId);
            if (index > -1) {
                favoriteGoods.splice(index, 1);
                saveFavorites();
                loadFavorites();
                renderGoods(cachedGoodsList);
            }
        }

        async function editGoods(index) {
            const goodsList = await loadGoods();
            const goods = goodsList[index];
            
            currentEditGoodsId = goods.id;

            closeMyModal();
            document.getElementById('publishModal').classList.add('active');
            document.getElementById('confirmBtn').textContent = 'ç¡®è®¤ä¿®æ”¹';

            setTimeout(() => {
                document.getElementById('nameInput').value = goods.name || '';
                document.getElementById('descInput').value = goods.desc || '';
                document.getElementById('originalPriceInput').value = goods.originalPrice || '';
                document.getElementById('salePriceInput').value = goods.salePrice || '';
                document.getElementById('contactInput').value = goods.contact || '';

                for (let i = 0; i < 3; i++) {
                    if (goods.imgBase64List[i]) {
                        imageBase64List[i] = goods.imgBase64List[i];
                        uploadedImages[i] = goods.imgBase64List[i];
                        
                        const uploadDiv = document.getElementById(`upload${i + 1}`);
                        uploadDiv.classList.add('has-image');
                        uploadDiv.innerHTML = `
                            <img class="image-preview" src="${goods.imgBase64List[i]}" alt="å•†å“å›¾ç‰‡">
                            <button class="delete-image" onclick="deleteImage(${i}, event)">Ã—</button>
                        `;
                    }
                }

                validateForm();
            }, 100);
        }

        async function deleteGoods(goodsId) {
            if (!confirm('ç¡®å®šè¦ä¸‹æ¶è¯¥å•†å“å—ï¼Ÿ')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/goods/delete`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ id: goodsId })
                });

                const result = await response.json();
                if (result.code === 200) {
                    alert('ä¸‹æ¶æˆåŠŸ');
                    loadMyGoods();
                    const goodsList = await loadGoods();
                    renderGoods(goodsList);
                } else {
                    alert('ä¸‹æ¶å¤±è´¥ï¼š' + result.msg);
                }
            } catch (error) {
                console.error('ä¸‹æ¶å¤±è´¥:', error);
                alert('ä¸‹æ¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }
    </script>
</body>
</html>